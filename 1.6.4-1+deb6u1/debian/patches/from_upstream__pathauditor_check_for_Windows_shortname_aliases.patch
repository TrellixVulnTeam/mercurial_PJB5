Origin: http://selenic.com/repo/hg-stable/rev/6dad422ecc5a
Description: pathauditor: check for Windows shortname aliases
 This is a fix for CVE-2014-9390
Applied-Upstream: 3.2.3

--- a/mercurial/util.py
+++ b/mercurial/util.py
@@ -513,6 +513,13 @@ class path_auditor(object):
             or _lowerclean(parts[0]) in ('.hg', '.hg.', '')
             or os.pardir in parts):
             raise Abort(_("path contains illegal component: %s") % path)
+        # Windows shortname aliases
+        for p in parts:
+            if "~" in p:
+                first, last = p.split("~", 1)
+                if last.isdigit() and first.upper() in ["HG", "HG8B6C"]:
+                    raise Abort(_("path contains illegal component: %s")
+                                     % path)
         if '.hg' in _lowerclean(path):
             lparts = [_lowerclean(p.lower()) for p in parts]
             for p in '.hg', '.hg.':
