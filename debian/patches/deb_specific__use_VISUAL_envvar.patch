Take care of $VISUAL and default to 'editor' instead of 'vi'
fix bug #447095, #448376
Index: mercurial-0.9.5/hgmerge
===================================================================
--- mercurial-0.9.5.orig/hgmerge	2007-10-28 22:59:31.000000000 +0100
+++ mercurial-0.9.5/hgmerge	2007-10-28 22:59:31.000000000 +0100
@@ -22,9 +22,8 @@
 BASE="$2"
 OTHER="$3"
 
-if [ -z "$EDITOR" ]; then
-    EDITOR="vi"
-fi
+EDITOR="${VISUAL:-${EDITOR:-editor}}"
+export VISUAL="$EDITOR"
 
 # find decent versions of our utilities, insisting on the GNU versions where we
 # need to
Index: mercurial-0.9.5/mercurial/commands.py
===================================================================
--- mercurial-0.9.5.orig/mercurial/commands.py	2007-10-28 23:08:55.000000000 +0100
+++ mercurial-0.9.5/mercurial/commands.py	2007-10-28 23:10:39.000000000 +0100
@@ -942,11 +942,12 @@
     ui.status(_("Checking commit editor...\n"))
     editor = (os.environ.get("HGEDITOR") or
               ui.config("ui", "editor") or
-              os.environ.get("EDITOR", "vi"))
+	      os.environ.get("VISUAL",
+                os.environ.get("EDITOR", "editor")))
     cmdpath = util.find_exe(editor) or util.find_exe(editor.split()[0])
     if not cmdpath:
-        if editor == 'vi':
-            ui.write(_(" No commit editor set and can't find vi in PATH\n"))
+        if editor == 'editor':
+            ui.write(_(" No commit editor set and can't find 'editor' in PATH\n"))
             ui.write(_(" (specify a commit editor in your .hgrc file)\n"))
         else:
             ui.write(_(" Can't find editor '%s' in PATH\n") % editor)
