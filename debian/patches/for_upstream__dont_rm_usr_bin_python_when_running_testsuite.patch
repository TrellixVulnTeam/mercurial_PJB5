Author: Javi Merino <vicho@debian.org>
Description: Don't rm /usr/bin/python when running the testsuite
 mercurial tries to delete /usr/bin/python when running the testsuite
 with "make tests TESTFLAGS=--with-hg=/usr/bin/hg".  If you're doing
 it as a user, the testsuite fails because it can't remove it.
 .
 This fixes it at least in Debian.  I'm unsure about other systems.
Bug: http://bz.selenic.com/show_bug.cgi?id=4045

Index: mercurial-4.3.1/tests/run-tests.py
===================================================================
--- mercurial-4.3.1.orig/tests/run-tests.py	2017-08-11 05:08:33.659485523 +0200
+++ mercurial-4.3.1/tests/run-tests.py	2017-08-11 05:08:33.655485456 +0200
@@ -2576,7 +2576,7 @@
                  sys.executable)
             mypython = os.path.join(self._tmpbindir, pyexename)
             try:
-                if os.readlink(mypython) == sys.executable:
+                if (mypython == sys.executable) or (os.readlink(mypython) == sys.executable):
                     return
                 os.unlink(mypython)
             except OSError as err:
