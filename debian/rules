#!/usr/bin/make -f
# -*- mode: makefile; coding: utf-8 -*-

DEB_PYTHON_SYSTEM=pysupport
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk
include /usr/share/cdbs/1/class/python-distutils.mk


binary-install/mercurial-web::
	chmod 0755 $(CURDIR)/debian/mercurial-web/usr/lib/cgi-bin/*


binary-install/mercurial::
	# Install system-wide conffiles
	echo "# system-wide mercurial configuration file" \
		>  $(CURDIR)/debian/mercurial/etc/mercurial/hgrc
	echo "# See hgrc(5) for more information" \
		>>  $(CURDIR)/debian/mercurial/etc/mercurial/hgrc

	rm -rf $(CURDIR)/debian/mercurial/usr/share/python-support/mercurial/mercurial/templates

	ln -sf ../../../mercurial/templates \
		$(CURDIR)/debian/mercurial/usr/share/python-support/mercurial/mercurial/templates

	chmod 0755  $(CURDIR)/debian/mercurial/usr/share/python-support/mercurial/mercurial/lsprof.py \
		$(CURDIR)/debian/mercurial/usr/share/python-support/mercurial/mercurial/simplemerge.py


build/mercurial-common::
	$(MAKE) -C doc man


clean::
	$(MAKE) clean
	$(RM) -rv tmp/

